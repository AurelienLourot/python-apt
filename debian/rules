#!/usr/bin/make -f

DEB_AUTO_CLEANUP_RCS := yes
DEB_PYTHON_SYSTEM=pycentral

export DH_PYCENTRAL=nomove

DEB_PYTHON_PACKAGES_EXCLUDE=python-apt-dbg

# Add here any variable or target overrides you need
include /usr/share/cdbs/1/rules/debhelper.mk
include /usr/share/cdbs/1/class/python-distutils.mk

# Add python3 versions to the list of python versions
cdbs_python_build_versions += $(shell find /usr/bin/python3.? | sed s/.*python//)


DEBVER=$(shell dpkg-parsechangelog |sed -n -e '/^Version:/s/^Version: //p')
DEB_COMPRESS_EXCLUDE:=.html .js _static/* _sources/* _sources/*/* .inv
DEB_PYTHON_INSTALL_ARGS_ALL=--no-compile --install-layout=deb 

# Define COMPAT_0_7 to get all the deprecated interfaces.
export CFLAGS+=-DCOMPAT_0_7 -Wno-write-strings
export DEBVER

build/python-apt-dbg::
	set -e; \
	for i in $(cdbs_python_build_versions); do \
	  python$$i-dbg ./setup.py build; \
	done

install/python-apt-dbg::
	for i in $(cdbs_python_build_versions); do \
	  python$$i-dbg ./setup.py install --root $(CURDIR)/debian/python-apt-dbg \
	                                   $(DEB_PYTHON_INSTALL_ARGS_ALL); \
	done
	find debian/python-apt-dbg \
		! -type d ! -name '*_d.so' | xargs rm -f
	find debian/python-apt-dbg -depth -empty -exec rmdir {} \;

binary-predeb/python-apt::
	ln -sf ../../../../javascript/jquery/jquery.js \
	       debian/python-apt/usr/share/doc/python-apt/html/_static/jquery.js

binary-predeb/python-apt-dbg::
	rm -rf debian/python-apt-dbg/usr/share/doc/python-apt-dbg
	ln -s python-apt debian/python-apt-dbg/usr/share/doc/python-apt-dbg

clean::
	rm -rf build/lib* build/temp* build
